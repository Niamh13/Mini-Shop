<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products</title>
</head>
<body>
    <h1>Products</h1>

    <form method="GET" action="/products">
        <input type="text" name="search" value="<%= search %>">
        <button type="submit">Search</button>
    </form>

    <% if (noProducts) { %>
        <p>No products found.</p>
    <% } else { %>
        <ul>
            <% products.forEach(p => { %>
                <li>
                    <strong><%= p.name %></strong> — €<%= p.price %>

                    <!-- SECURE add-to-cart POST -->
                    <form method="POST" action="/cart/add/<%= p.id %>" style="display:inline;">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <button type="submit">Add to cart</button>
                    </form>

                    <a href="/products/<%= p.id %>">View</a>
                </li>
            <% }) %>
        </ul>
    <% } %>

    <hr>
    <a href="/">Back to Home</a>
</body>
</html>
